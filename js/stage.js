//////////////////////////
// STAGE
//////////////////////////
class Stage {
    constructor(stageNum, assets, displayWidth ,displayHeight) {

        this.pattern1 = 
            [6, 3, 3, 2, 3, 2, 3, 2, 3, 2, 3, 3, 3, 2, 8, 2, 3, 5, 3, 4,
            2, 3, 2, 6, 2, 2, 2, 3, 2, 3, 2, 3, 2, 3, 2, 8, 2, 3, 2, 3,
            1, 2, 8, 2, 3, 2, 3, 7, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 4,
            5, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3,
            6, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 6, 2, 3, 2, 3, 4,
            5, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 8,
            1, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 7,
            1, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 8,
            1, 2, 3, 2, 3, 2, 3, 2, 6, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2,
            5, 3, 2, 3, 2, 3, 2, 3, 2, 8, 2, 3, 2, 3, 2, 3, 2, 3, 2, 8,
            6, 2, 3, 5, 3, 2, 3, 2, 8, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 7,
            1, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 5, 3, 2, 3, 2, 4,
            1, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 3, 3, 4,
            5, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 7,
            1, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 2, 3, 5, 6, 2,
            2, 3, 3, 3, 7, 3, 2, 3, 2, 3, 2, 8, 2, 3, 2, 3, 2, 6, 3, 4];

        this.pattern2 = [
            7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,
8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8
        ]

            this.bg = {
                array: [...this.pattern1], // Esto asi es necesario! necesitamos una copia del arr
                queue: [],
                tileSize: 16,
                changePattern: false,
                speed: 2,
                spriteCols: 4,
                pngScale: 32,
                sprite: assets['bg' + stageNum]
            };
            this.bg.tileQty = this.getTileQty(this.bg.tileSize, displayWidth, displayHeight);
            this.bg.rows = this.setRows(this.bg.tileSize, displayHeight)
            this.bg.numCols = displayWidth / this.bg.tileSize;
        }

        setRows (tile, displayHeight) {
            let arr = [];
            for (let n = -tile; n < displayHeight; n += tile) arr.push(n);
            return arr;
            // With 16px tiles, this will return:
            // [-16, 0, 16, 32, 48, 64, 80, 96, 112, 128, 144, 160, 176, 192, 208, 224]
        }

        getTileQty(tileSize, displayWidth, displayHeight) {
            let heightPlusOneRow = displayHeight + tileSize;
            return (displayWidth / tileSize) * (heightPlusOneRow / tileSize);
        }
};
